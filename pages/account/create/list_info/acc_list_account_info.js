/*** INIT VIEW ***/var tenor;function loadInitXML() {    logInfo('list amf list account init');}/*** VIEW LOAD SUCCESS Thực hiện việc gọi lên service để lấy dữ liệu ***/function viewDidLoadSuccess() {    logInfo('list amf list account load success');    if (CONST_DESKTOP_MODE && !checkScreenisMobilePX()) {        gAccount.rowsPerPage = 10;    }else{        gAccount.rowsPerPage = 5;    }    gAccount.totalPagesCounter = 0;    gAccount.totalPagesOnline = 0;    if (gUserInfo.userRole.indexOf('CorpInput') == -1 && document.getElementById("listInfoExe") != null) {        var elem11 = document.getElementById("listInfoExe");        elem11.parentNode.removeChild(elem11);        if (gUserInfo.userRole.indexOf('CorpAuth') == -1) {            var tab = document.getElementById("tr-tab");            if (tab != null)                tab.parentNode.removeChild(tab);        }    }    // Set dữ liệu trước khi gọi service    init();}function init() {    angular.module("EbankApp").controller("acc-list-account-info", function ($scope, requestMBServiceCorp) {        initData();        function initData() {            var argsArray = [""];            argsArray.push({                sequenceId:1,                idtxn:"A12"            });            var gprsCmd = new GprsCmdObj(CONSTANTS.get("CMD_CO_ACC_LIST_ACCOUNT_INFO"), "", "", gUserInfo.lang, gUserInfo.sessionID, argsArray);            data = getDataFromGprsCmd(gprsCmd);            requestMBServiceCorp.post(data, true, requestAccListAccountSuccess, requestAccListAccountFail);        }		// Chuyển sang màn hình 'Mở tài khoản'        $scope.gotoScreenCreateAccount = function () {            clearCachedPagePushToView('account/create/saving/acc_saving_account', true, 'html');        }				// Chuyển sang tab 'Tra cứu giao dịch'		$scope.showPageFindTrans = function (){			navCachedPages['account/create/search_transaction_acc_open_close/acc-query_transaction'] = null;			navController.pushToView('account/create/search_transaction_acc_open_close/acc-query_transaction', true, 'html');		}    });    angular.bootstrap(document.getElementById("mainViewContent"), ["EbankApp"]);}/*** VIEW WILL UNLOAD ***/function viewWillUnload() {    logInfo('Khai bao lich chuyen tien');}// Thực hiện xử lý sau khi gọi thành công// Lấy dữ liệu được trả về từ service đẩy lên trangfunction requestAccListAccountSuccess(e) {    gprsResp = JSON.parse(JSON.stringify(e));    if (gprsResp.respCode == RESP.get('COM_SUCCESS') && parseInt(gprsResp.responseType) == CONSTANTS.get(        'CMD_CO_ACC_LIST_ACCOUNT_INFO')) {        //mainContentScroll.refresh();        // for counter        gAccount.listAmountCounter = gprsResp.respJsonObj.listAmountCounter;        if (gAccount.listAmountCounter.length == 0) {            document.getElementById("tblContentCounter").innerHTML = CONST_STR.get('CORP_MSG_COM_NO_DATA_FOUND');            document.getElementById("total_amount_counter").innerHTML = "";        } else {            gAccount.totalPagesCounter = getTotalPages(gAccount.listAmountCounter.length);            var inArrCounter = new Array();            if (gAccount.listAmountCounter.length > gAccount.rowsPerPage) {                for (var i = 0; i < gAccount.rowsPerPage; i++) {                    inArrCounter.push(gAccount.listAmountCounter[i]);                }            } else {                for (var i = 0; i < gAccount.listAmountCounter.length; i++) {                    inArrCounter.push(gAccount.listAmountCounter[i]);                }            }            document.getElementById("tblContentCounter").innerHTML = genHtmlDoc(inArrCounter);            genPagging(gAccount.totalPagesCounter, 1, 'pageCounter', 0);            // Thuc hien viec hien thi ra tong so tien            document.getElementById("total_amount_counter").innerHTML = "";            var typeMoney = Object.keys(gprsResp.respJsonObj.totalAmountCounter);            for (var j = 0; j < typeMoney.length; j++) {                var div = document.createElement("div");                div.setAttribute("style", "font-weight: bold;");                div.innerHTML = formatString(CONST_STR.get('ACCOUNT_PERIOD_TOTAL_AMOUNT_PARAM'), [typeMoney[j],                    gprsResp.respJsonObj.totalAmountCounter[typeMoney[j]]                ]);                document.getElementById("total_amount_counter").appendChild(div);            }        }        // for online        gAccount.listAmountOnline = gprsResp.respJsonObj.listAmountOnline;        if (gAccount.listAmountOnline.length == 0) {            document.getElementById("tblContentOnline").innerHTML = CONST_STR.get('CORP_MSG_COM_NO_DATA_FOUND');            document.getElementById("total_amount_online").parentElement.style.display = "none";        } else {            gAccount.totalPagesOnline = getTotalPages(gAccount.listAmountOnline.length);            var inArrOnline = new Array();            gAccount.totalPages = getTotalPages(gAccount.listAmountOnline.length);            if (gAccount.listAmountOnline.length > gAccount.rowsPerPage) {                for (var i = 0; i < gAccount.rowsPerPage; i++) {                    inArrOnline.push(gAccount.listAmountOnline[i]);                }            } else {                for (var i = 0; i < gAccount.listAmountOnline.length; i++) {                    inArrOnline.push(gAccount.listAmountOnline[i]);                }            }            document.getElementById("tblContentOnline").innerHTML = genHtmlDoc(inArrOnline);            genPagging(gAccount.totalPagesOnline, 1, 'pageOnline', 1);            document.getElementById("total_amount_online").innerHTML = gprsResp.respJsonObj.totalAmountOnline;            document.getElementById("total_amount_online").parentElement.style.float = "left";        }    } else {        if (gprsResp.respCode == '1019') {            showAlertText(gprsResp.respContent);        } else {            showAlertText(CONST_STR.get('ERR_COM_TRANS_FAILED'));        }        var tmpPageName = navController.getDefaultPage();        var tmpPageType = navController.getDefaultPageType();        navController.pushToView(tmpPageName, true, tmpPageType);    }}function requestAccListAccountFail(e) {}function getTotalPages(totalRows) {    return totalRows % gAccount.rowsPerPage == 0 ? Math.floor(totalRows / gAccount.rowsPerPage) : Math.floor(totalRows / gAccount.rowsPerPage) + 1;}function genPagging(totalPages, pageIdx, pageDivId, typeTable) {    var tmpStr = genPageIndicatorHtml(totalPages, pageIdx, 6, typeTable); //Tong so trang - trang hien tai    var dataPageGen = tmpStr.replace(new RegExp('selectedPageAtIndex', 'g'), 'ckhSelectedPage');    gAccount.typeTable = typeTable;    document.getElementById(pageDivId).innerHTML = dataPageGen;}function ckhSelectedPage(idx, inNode, inTotalPage, inMaxNum, typeTable) {    isNotNeedReloadPageStyleSheet = true;    fadeOutMainContentScreen();    setTimeout(function () {        var nodePager1 = inNode.parentNode.parentNode;        var tmpStr = genPageIndicatorHtml(inTotalPage, idx, inMaxNum, typeTable);        var dataPageGen = tmpStr.replace(new RegExp('selectedPageAtIndex', 'g'), 'ckhSelectedPage');        nodePager1.innerHTML = dataPageGen;        pageIndicatorSelected(idx, nodePager1, typeTable);        setTimeout(function () {            // if (mainContentScroll) {            //     // mainContentScroll.refresh();            // }        }, 100)    }, 500);    fadeInMainContentScreen();}function pageIndicatorSelected(selectedIdx, selectedPage, typeTable) {    var dataGen = {};    var tableIdReGen = "";    if (typeTable == 0) {        document.getElementById('tblContentCounter').innerHTML = "";        dataGen = gAccount.listAmountCounter;        tableIdReGen = 'tblContentCounter';    } else if (typeTable == 1) {        document.getElementById('tblContentOnline').innerHTML = "";        dataGen = gAccount.listAmountOnline;        tableIdReGen = 'tblContentOnline';    }    var startIdx = (selectedIdx - 1) * gAccount.rowsPerPage;    var endIdx = startIdx + gAccount.rowsPerPage;    var listPending = new Array();    for (var i = startIdx; i < endIdx; i++) {        if (typeTable == 0) {            if (gAccount.listAmountCounter[i] != undefined) {                listPending.push(gAccount.listAmountCounter[i]);            }        } else if (typeTable == 1) {            if (gAccount.listAmountOnline[i] != undefined) {                listPending.push(gAccount.listAmountOnline[i]);            }        }    }    if (listPending) document.getElementById(tableIdReGen).innerHTML = genHtmlDoc(listPending);    genPagging(gAccount.totalPagesCounter, selectedIdx, 'pageCounter', typeTable);}// Chuyển sang màn hình 'Xem chi tiết'function clickDetail(dtlAcc, dtlType, dtlTypeMoney, dtlAmount, dtlTenorDays, dtlTenorMonths, dtlTenorYear, dtlInterestRate, dtlProfitsInterim, dtlDateStart, dtlDateEnd, dtlSoPhongToa, dtlLyDoPhongToa) {    // set data to gAccount    gAccount.accNumber = dtlAcc;    gAccount.accType = dtlType;    gAccount.accTypeMoney = dtlTypeMoney;    gAccount.accAmount = dtlAmount;    gAccount.accTenorDays = dtlTenorDays;    gAccount.accTenorMonths = dtlTenorMonths;    gAccount.accTenorYears = dtlTenorYear;    gAccount.accInterestRate = dtlInterestRate;    gAccount.accProfitsInterim = dtlProfitsInterim;    gAccount.accDateStart = dtlDateStart;    gAccount.accDateEnd = dtlDateEnd;    gAccount.accSoPhongToa = dtlSoPhongToa;    gAccount.accLyDoPhongToa = dtlLyDoPhongToa;    getTenor(gAccount);    if(gAccount.accType == 'Y'){        titleAccType = CONST_STR.get('ACCOUNT_PERIOD_ONLINE');    }else{        titleAccType = CONST_STR.get('ACCOUNT_PERIOD_COUNTER');    }        var arraccinfo = [];    row1 = [CONST_STR.get('ACCOUNT_PERIOD_TYPE'), titleAccType];    row2 = [CONST_STR.get('COM_ACCOUNT_NUMBER'), gAccount.accNumber];    row3 = [CONST_STR.get('COM_NUM_MONEY_SAVING'), gAccount.accAmount + ' ' +gAccount.accTypeMoney];    row4 = [CONST_STR.get('COM_PERIOD'), tenor];    row5 = [CONST_STR.get('ACC_INTEREST_YEAR'), gAccount.accInterestRate];    row6 = [CONST_STR.get('ACC_PROFITS_INTERIM'), gAccount.accProfitsInterim + ' ' +gAccount.accTypeMoney];    row7 = [CONST_STR.get('ACCOUNT_PERIOD_DATESTART'), gAccount.accDateStart];    row8 = [CONST_STR.get('ACCOUNT_AMOUNT_BLOCK'), gAccount.accSoPhongToa];    row9 = [CONST_STR.get('COM_DEADLINE_DATE'), gAccount.accDateEnd];    row10 = [CONST_STR.get('ACCOUNT_REASON_BLOCK'), gAccount.accLyDoPhongToa];        gArraccinfo = [row1, row2, row3,  row4,  row5,  row6,  row7,  row8,  row9,  row10];    // goto screen    updateAccountListInfo();    navController.pushToView('account/create/list_info/acc_list_account_info_dtl', true, 'html');}function genHtmlDoc(inArrAcc) {    if (inArrAcc == null) alert('null');    var length = inArrAcc.length;    var contentItem = '';    for (var i = 0; i < length; i++) {        var inAccObj = inArrAcc[i];        var interestRateNew = inAccObj.INT_RATE + "%";        if (interestRateNew.substring(0, 1) == '.') {            interestRateNew = '0' + interestRateNew;        }        var tbl_profits_interim;        if (inAccObj.IS_TYPE == 'N') {            tbl_profits_interim = '-';        } else if (inAccObj.IS_TYPE == 'Y') {            tbl_profits_interim = inAccObj.AMOUNTACC;        }        var custAcNo = "'" + inAccObj.CUST_AC_NO + "'";        var isType = "'" + inAccObj.IS_TYPE + "'";        var txnCcy = "'" + inAccObj.TXN_CCY + "'";        var depositAmt = "'" + inAccObj.DEPOSIT_AMT + "'";        var tenorDays = "'" + inAccObj.TENOR_DAYS + "'";        var tenorMonths = "'" + inAccObj.TENOR_MONTHS + "'";        var tenorYears = "'" + inAccObj.TENOR_YEARS + "'";        var intRate = "'" + interestRateNew + "'";        var startDate = "'" + inAccObj.STARTDATE + "'";        var endDate = "'" + inAccObj.MATURITYDATE + "'";        var soPhongToa = "'" + inAccObj.SO_PHONG_TOA + "'";        var lyDoPhongToa = "'" + inAccObj.LY_DO_PHONG_TOA + "'";        var tblProfits = "'" + tbl_profits_interim + "'";        // title        var contentHTML = '';        contentHTML += "<table width='96%' align='center' class='recycler-table-ebank desktopview'>";        contentHTML += "<tr class='recycler-row-title-header recycler-list'>";        contentHTML += "<td width='14%' class='recycler-row-align-midle'><span>" + CONST_STR.get('ACCOUNT_ACC_NO_TITLE') + "</span></td>";        contentHTML += "<td width='16%' class='recycler-row-align-midle'><span>" + CONST_STR.get('ACCOUNT_PERIOD_TYPE') + "</span></</td>";        contentHTML += "<td width='14%' class='recycler-row-align-midle'><span>" + CONST_STR.get('TRANS_LOCAL_AMOUNT_TITLE') + "</span></td>";        contentHTML += "<td width='11%' class='recycler-row-align-midle'><span>" + CONST_STR.get('ACC_INTEREST_YEAR') + "</span></td>";        contentHTML += "<td width='13%' class='recycler-row-align-midle'><span>" + CONST_STR.get('ACCOUNT_PERIOD_DATESTART') + "</span></td>";        contentHTML += "<td width='13%' class='recycler-row-align-midle'><span>" + CONST_STR.get('ACCOUNT_PERIOD_DATEEND') + "</span></td>";        contentHTML += "<td width='10%'  class='recycler-row-align-midle'><span>" + CONST_STR.get('ACC_CURRENCY_TITLE') + "</span></td>";        contentHTML += "<td width='12%' class='recycler-row-align-midle'><span>" + CONST_STR.get('JUMBO_TEMPORARY_INTEREST') + "</span></td>";        contentHTML += "</tr>";        contentItem += '<tr class="recycler-row-title recycler-list">';        contentItem += '<td class="recycler-row-align-midle-left" width="12%"><span><a class="ref-link" onclick="clickDetail('            + custAcNo + ',' + isType + ',' + txnCcy + ',' + depositAmt + ',' + tenorDays + ','            + tenorMonths + ',' + tenorYears + ',' + intRate + ',' + tblProfits + ','            + startDate + ',' + endDate + ',' + soPhongToa + ',' + lyDoPhongToa + ')"'            + 'href="javascript:void(0)">' + inAccObj.CUST_AC_NO +'</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>' + inAccObj.LOAI_TIET_KIEM + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>' +  inAccObj.DEPOSIT_AMT + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>' + interestRateNew + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>' + inAccObj.STARTDATE + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>' + inAccObj.MATURITYDATE + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>'+ inAccObj.TXN_CCY + '</span></td>';        contentItem += '<td class="recycler-row-align-midle"><span>'+ inAccObj.AMOUNTACC + '</span></td></tr>';            }    var contentItemmb = '';    var contentHTMLmb = '';    contentHTMLmb += "<div align='center' class='recycler-table-ebank  mobileview'>";    for (var j = 0; j < 5; j++) {        var inAccObj = inArrAcc[j];        if (inAccObj != undefined) {            contentItemmb += "<table style='margin-bottom:10px; margin-top: 10px;' width='96%'  class='recycler-list'>";                    contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACCOUNT_ACC_NO_TITLE') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right" style="word-break: break-all;"><span><a style="cursor:pointer; white-space:pre-wrap;" onclick="clickDetail('                        + custAcNo + ',' + isType + ',' + txnCcy + ',' + depositAmt +  ',' + tenorDays +  ',' + tenorMonths + ',' + tenorYears + ','                        + intRate + ',' + tblProfits + ',' + startDate + ',' + endDate + ',' + soPhongToa + ',' + lyDoPhongToa +')"'                        + 'href="javascript:void(0)">' + inAccObj.CUST_AC_NO + '</a></span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACCOUNT_PERIOD_TYPE') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.LOAI_TIET_KIEM + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('TRANS_LOCAL_AMOUNT_TITLE') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.DEPOSIT_AMT + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACC_INTEREST_YEAR') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  interestRateNew + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACCOUNT_PERIOD_DATESTART') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.STARTDATE + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACCOUNT_PERIOD_DATEEND') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.MATURITYDATE + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('ACC_CURRENCY_TITLE') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.TXN_CCY + '</span></td></tr>';            contentItemmb += '<tr class="recycler-row-normal">';            contentItemmb += '<td colspan="1" class="recycler-row-align-midle-left"><span>' +  CONST_STR.get('JUMBO_TEMPORARY_INTEREST') + '</span></td>';            contentItemmb += '<td class="recycler-row-align-midle-right"><span>' +  inAccObj.AMOUNTACC + '</span></td></tr></table>';        }        }    contentHTML += contentItem + "</tbody></table>";    contentHTMLmb += contentItemmb + '</div>';    return contentHTML += contentHTMLmb; }HTMLElement.prototype.offsetHeight = 0;function showDetailinfoCounter() {    var idcontent111 = document.getElementById('showDetailCounter');    var offsetHeight = idcontent111.offsetHeight;    var idtitle = document.getElementById('headclCounter');    if (offsetHeight == 0)    {        idtitle.style.transform = 'rotate(90deg)';        idcontent111.style.height= 'auto';        idcontent111.style.display = 'block';    }    else    {        idtitle.style.transform = 'rotate(0deg)';        idcontent111.style.height = '0px';        idcontent111.style.display ='none';    }}function showDetailinfoOnline() {    var idcontent111 = document.getElementById('showDetailOnline');    var offsetHeight = idcontent111.offsetHeight;    var idtitle = document.getElementById('headclOnline');    if (offsetHeight == 0)    {        idtitle.style.transform = 'rotate(90deg)';        idcontent111.style.height= 'auto';        idcontent111.style.display = 'block';    }    else    {        idtitle.style.transform = 'rotate(0deg)';        idcontent111.style.height = '0px';        idcontent111.style.display ='none';    }}function getTenor(gAccount){    var tenorday = parseInt(gAccount.accTenorDays);    var tenormonth = parseInt(gAccount.accTenorMonths);    var tenoryear = parseInt(gAccount.accTenorYears);    var counttenor = tenorday + 30*tenormonth +365*tenoryear;    if(counttenor>0){        if(tenorday <1){            if(tenormonth >0){                if(tenoryear >0){                    tenor= gAccount.accTenorYears+ ' ' + CONST_STR.get('TRANS_PERIODIC_YEAR')+' '+gAccount.accTenorMonths + ' ' + CONST_STR.get('TRANS_PERIODIC_MONTH');                }                else {                    tenor= gAccount.accTenorMonths + ' ' + CONST_STR.get('TRANS_PERIODIC_MONTH');                }            }            else if(tenormonth <1){                tenor= gAccount.accTenorYears+ ' ' + CONST_STR.get('TRANS_PERIODIC_YEAR');            }        }        else if(tenorday >0){            if(tenormonth >0){                if(tenoryear >0){                    tenor=  gAccount.accTenorYears+ ' ' + CONST_STR.get('TRANS_PERIODIC_YEAR')+' '+ gAccount.accTenorMonths + ' ' + CONST_STR.get('TRANS_PERIODIC_MONTH')+' '+gArraySav.tenor_day + ' '+ CONST_STR.get('TRANS_PERIODIC_DATE1');                }                else {                    tenor=  gAccount.accTenorMonths + ' ' + CONST_STR.get('TRANS_PERIODIC_MONTH')+' '+gArraySav.tenor_day + ' '+ CONST_STR.get('TRANS_PERIODIC_DATE1');                }            }            else if(tenormonth <1){                if(tenoryear >0){                    tenor=  gArraySav.tenor_year+ ' ' + CONST_STR.get('TRANS_PERIODIC_YEAR')+' '+gAccount.accTenorDays + ' '+ CONST_STR.get('TRANS_PERIODIC_DATE1');                }                else{                    tenor= gAccount.accTenorDays + ' '+ CONST_STR.get('TRANS_PERIODIC_DATE1');                }            }        }    }}